
flowchart TD
    Start([Entrada do Usu√°rio - Veterin√°rio]) --> AgentA_In
    
    AgentA_In[üü¶ Agente A - Interface<br/>Extra√ß√£o de Dados] --> |clinical_data| CheckData{Dados<br/>v√°lidos?}
    
    CheckData -->|Sim| AgentB[üü© Agente B - Infer√™ncia Ontol√≥gica<br/>OWL + Pellet Reasoner]
    CheckData -->|N√£o| Error1[‚ùå Erro: Dados insuficientes<br/>Solicite creatinina ou SDMA]
    Error1 --> AgentA_Out
    
    AgentB --> |inference_result| CheckDiscrepancy{Discrep√¢ncia<br/>entre biomarcadores?}
    
    CheckDiscrepancy -->|‚â• 2 est√°gios| Error2[‚ö†Ô∏è Alerta Cr√≠tico<br/>Repetir exames laboratoriais]
    CheckDiscrepancy -->|‚â§ 1 est√°gio| AgentC[üü® Agente C - Valida√ß√£o RAG<br/>Chroma DB + Diretrizes IRIS]
    
    Error2 --> AgentA_Out
    
    AgentC --> |validated_result| CheckRAG{RAG encontrou<br/>informa√ß√µes?}
    
    CheckRAG -->|Sim| Validation{B e C<br/>concordam?}
    CheckRAG -->|N√£o| Fallback[‚ö†Ô∏è Usar apenas resultado B<br/>Confian√ßa reduzida]
    
    Validation -->|Sim - 85%| HighConf[‚úÖ Alta Confian√ßa<br/>Est√°gio validado]
    Validation -->|Parcial| MedConf[‚ö†Ô∏è M√©dia Confian√ßa<br/>Revisar manualmente]
    
    HighConf --> AgentA_Out
    MedConf --> AgentA_Out
    Fallback --> AgentA_Out
    
    AgentA_Out[üü¶ Agente A - Sa√≠da<br/>Humaniza√ß√£o + Formata√ß√£o] --> |final_answer| End([Resposta ao Veterin√°rio<br/>Com cita√ß√µes e rastreabilidade])
    
    %% Estilos
    classDef agentA fill:#4A90E2,stroke:#2E5C8A,color:#fff
    classDef agentB fill:#7ED321,stroke:#5A9B18,color:#000
    classDef agentC fill:#F5A623,stroke:#C47D0A,color:#000
    classDef error fill:#D0021B,stroke:#8B0115,color:#fff
    classDef success fill:#50E3C2,stroke:#2FA88F,color:#000
    classDef decision fill:#FFB84D,stroke:#CC8A3D,color:#000
    
    class AgentA_In,AgentA_Out agentA
    class AgentB agentB
    class AgentC agentC
    class Error1,Error2 error
    class HighConf,End success
    class CheckData,CheckDiscrepancy,CheckRAG,Validation decision
